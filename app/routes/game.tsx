import React, { useState, useEffect } from "react";
import { useNavigate, useLoaderData } from "@remix-run/react";
import { json } from "@remix-run/node";

const GAME_DURATION = 60; // in seconds
const TILT_THRESHOLD = 15; // degrees

export const loader = async () => {
  const words = [
    "أمل",
    "حب",
    "سلام",
    "حرية",
    "كتاب",
    "شجرة",
    "سماء",
    "أرض",
    "ماء",
    "نار",
    "بيت",
    "طريق",
    "سيارة",
    "طائرة",
    "بحر",
    "نهر",
    "جبل",
    "زهرة",
    "قمر",
    "شمس",
    "ليل",
    "نهار",
    "طفل",
    "بنت",
    "ولد",
    "أب",
    "أم",
    "أخ",
    "أخت",
    "جد",
    "جدة",
    "معلم",
    "مدرسة",
    "جامعة",
    "عمل",
    "صديق",
    "طعام",
    "شراب",
    "قهوة",
    "شاي",
    "خبز",
    "لحم",
    "فواكه",
    "خضار",
    "سوق",
    "مدينة",
    "قرية",
    "حديقة",
    "نجم",
    "سماء",
    "كوكب",
    "زمن",
    "ساعة",
    "دقيقة",
    "ثانية",
    "يوم",
    "أسبوع",
    "شهر",
    "سنة",
    "فصل",
    "صيف",
    "شتاء",
    "ربيع",
    "خريف",
    "كتاب",
    "قلم",
    "ورقة",
    "رسالة",
    "كلمة",
    "حرف",
    "لغة",
    "صوت",
    "أغنية",
    "رقصة",
    "لوحة",
    "فن",
    "موسيقى",
    "رياضة",
    "لعبة",
    "كرة",
    "قدم",
    "يد",
    "رأس",
    "عين",
    "أنف",
    "فم",
    "أذن",
    "شعر",
    "وجه",
    "رقبة",
    "كتف",
    "ظهر",
    "بطن",
    "رجل",
    "قدم",
    "يد",
    "أصبع",
    "قلب",
    "دماغ",
    "حياة",
    "موت",
    "حلم",
    "واقع",
    "نور",
    "ظلام",
    "ليل",
    "صباح",
    "مساء",
    "غابة",
    "صحراء",
    "جزيرة",
    "بحيرة",
    "عين",
    "باب",
    "نافذة",
    "سقف",
    "حائط",
    "أثاث",
    "كرسي",
    "طاولة",
    "سرير",
    "مكتب",
    "مطبخ",
    "حمام",
    "غرفة",
    "منزل",
    "مبنى",
    "مطار",
    "محطة",
    "قطار",
    "حافلة",
    "دراجة",
    "طريق",
    "شارع",
    "سيارة",
    "موقف",
    "جسر",
    "مزرعة",
    "حقل",
    "نبات",
    "حيوان",
    "كلب",
    "قطة",
    "حصان",
    "بقرة",
    "خروف",
    "جمل",
    "فيل",
    "طائر",
    "سمكة",
    "دجاجة",
    "بيضة",
    "عسل",
    "ملح",
    "سكر",
    "فلفل",
    "ليمون",
    "تفاح",
    "برتقال",
    "موز",
    "عنب",
    "فراولة",
    "بطيخ",
    "كيوي",
    "أناناس",
    "جزر",
    "بطاطس",
    "طماطم",
    "خيار",
    "فلفل",
    "بصل",
    "ثوم",
    "زنجبيل",
    "زيت",
    "حليب",
    "جبن",
    "زبدة",
    "لبن",
    "عصير",
    "ماء",
    "شوكولاتة",
    "كعكة",
    "بسكويت",
    "فطيرة",
    "معكرونة",
    "أرز",
    "دجاج",
    "لحم",
    "سمك",
    "حساء",
    "سلطة",
    "مائدة",
    "سكين",
    "شوكة",
    "ملعقة",
    "طبق",
    "كأس",
    "زجاجة",
    "مغسلة",
    "ثلاجة",
    "فرن",
    "غسالة",
    "مروحة",
    "ساعة",
    "مرآة",
    "مشط",
    "فرشاة",
    "صابون",
    "منشفة",
    "ملابس",
    "قميص",
    "بنطال",
    "جاكيت",
    "حذاء",
    "قبعة",
    "قفاز",
    "جورب",
    "حزام",
    "نظارة",
    "حقيبة",
    "مظلة",
    "هاتف",
    "كمبيوتر",
    "لوحة مفاتيح",
    "فأرة",
    "شاشة",
    "طابعة",
    "كهرباء",
    "مصباح",
    "بطارية",
    "شاحن",
    "راديو",
    "تلفاز",
    "كاميرا",
    "ميكروفون",
    "صوت",
    "ضوء",
    "مسرح",
    "سينما",
    "متحف",
    "مكتبة",
    "حديقة",
    "مسجد",
    "كنيسة",
    "معبد",
    "مستشفى",
    "صيدلية",
    "عيادة",
    "طبيب",
    "ممرض",
    "دواء",
    "علاج",
    "صحة",
    "مرض",
    "نوم",
    "راحة",
    "تعب",
    "نشاط",
    "عمل",
    "وظيفة",
    "مكتب",
    "شركة",
    "مصنع",
    "متجر",
    "بنك",
    "مال",
    "عملة",
    "سعر",
    "تجارة",
    "شراء",
    "بيع",
    "ربح",
    "خسارة",
    "سفر",
    "تذكرة",
    "رحلة",
    "حقيبة",
    "خارطة",
    "فندق",
    "غرفة",
    "حجز",
    "مفتاح",
    "سائح",
    "زيارة",
    "سفينة",
    "ميناء",
    "مدينة",
    "عاصمة",
    "بلد",
    "قارة",
    "خريطة",
    "جبال",
    "وادي",
    "نهر",
    "بحيرة",
    "شاطئ",
    "رمل",
    "موجة",
    "غوص",
    "سباحة",
    "قارب",
    "شراع",
    "صيد",
    "سمك",
    "طير",
    "ريش",
    "عش",
    "بيض",
    "غابة",
    "أشجار",
    "ورود",
    "عطر",
    "رائحة",
    "نسيم",
    "رياح",
    "عاصفة",
    "ثلج",
    "مطر",
    "سحاب",
    "برق",
    "رعد",
    "طقس",
    "حرارة",
    "برد",
    "جفاف",
    "رطوبة",
    "ظل",
    "ضوء",
    "مظلم",
    "مشرق",
    "شروق",
    "غروب",
    "لعبة",
    "دور",
    "فريق",
    "نقطة",
    "فوز",
    "خسارة",
    "حكم",
    "لاعب",
    "جمهور",
    "مدرب",
    "ملعب",
    "كرة",
    "هدف",
    "شبكة",
    "دفاع",
    "هجوم",
    "سرعة",
    "قوة",
    "تدريب",
    "بطولة",
    "كأس",
    "ميدالية",
    "رياضة",
    "سباق",
    "جري",
    "قفز",
    "رمي",
    "سباحة",
    "جمباز",
    "مصارعة",
    "ملاكمة",
    "تنس",
    "كرة قدم",
    "كرة سلة",
    "كرة طائرة",
    "غولف",
    "دراجة",
    "دراجات",
    "ركض",
    "مشي",
    "حركة",
    "هدوء",
    "سرية",
    "رسالة",
    "مكالمة",
    "اتصال",
    "تواصل",
    "شبكة",
    "إنترنت",
    "موقع",
    "صفحة",
    "رابط",
    "إشارة",
    "تحميل",
    "تنزيل",
    "رفع",
    "إرسال",
    "استقبال",
    "بريد",
    "رسائل",
    "محادثة",
    "صورة",
    "فيديو",
    "ملف",
    "مستند",
    "نص",
    "كتابة",
    "تدوين",
    "قراءة",
    "دراسة",
    "تعليم",
    "تعلم",
    "مدرسة",
    "جامعة",
    "مكتبة",
    "صف",
    "طالب",
    "أستاذ",
    "كتاب",
    "دفتر",
    "قلم",
    "مسطرة",
    "حقيبة",
    "سبورة",
    "لوحة",
    "درس",
    "اختبار",
    "نتيجة",
    "شهادة",
    "نجاح",
    "فشل",
    "تخرج",
    "تفوق",
    "معرفة",
    "معلومة",
    "بحث",
    "استكشاف",
    "علم",
    "تجربة",
    "اختراع",
    "ابتكار",
    "اكتشاف",
    "فكرة",
    "خطة",
    "هدف",
    "طموح",
    "أمل",
    "حلم",
    "نجاح",
    "إصرار",
    "إرادة",
    "ثقة",
    "شجاعة",
    "تحدي",
    "تعاون",
    "مساعدة",
    "عمل",
    "جهد",
    "وقت",
    "فراغ",
    "تسلية",
    "متعة",
    "سعادة",
    "فرح",
    "ضحك",
    "ابتسامة",
    "حب",
    "عشق",
    "وفاء",
    "صداقة",
    "عائلة",
    "والد",
    "والدة",
    "أخ",
    "أخت",
    "ابن",
    "ابنة",
    "جد",
    "جدة",
    "عم",
    "عمة",
    "خال",
    "خالة",
    "صديق",
    "زميل",
    "جار",
    "معلم",
    "مدير",
    "موظف",
    "عامل",
    "طبيب",
    "مهندس",
    "محامي",
    "فنان",
    "كاتب",
    "شاعر",
    "رسام",
    "ممثل",
    "مغني",
    "مصور",
    "لاعب",
    "مذيع",
    "صحفي",
    "مخرج",
    "رئيس",
    "وزير",
    "ملك",
    "أمير",
    "سلطان",
    "قائد",
    "جندي",
    "شرطة",
    "حارس",
    "سياسي",
    "سفير",
    "قاضي",
    "حكم",
    "مستشار",
    "خبير",
    "باحث",
    "معلم",
    "طبيب",
    "ممرض",
    "فلاح",
    "صياد",
    "نجار",
    "حداد",
    "عامل",
    "مزارع",
    "بائع",
    "تاجر",
    "سائق",
    "طباخ",
    "نادل",
    "حارس",
    "خياط",
    "حلاق",
    "مصفف",
    "عامل نظافة",
    "كهربائي",
    "سباك",
    "بناء",
    "ميكانيكي",
    "مهندس",
    "مبرمج",
    "مصمم",
    "فني",
    "فنان",
    "مغني",
    "راقص",
    "كاتب",
    "شاعر",
    "رسام",
    "ممثل",
    "مخرج",
    "منتج",
    "صحفي",
    "مصور",
    "مذيع",
    "معلق",
    "مدرب",
    "قائد",
    "مدير",
    "رئيس",
    "وزير",
    "ملك",
    "أمير",
    "سلطان",
    "شيخ",
    "عمدة",
    "والي",
    "قاضي",
    "محامي",
    "مستشار",
    "خبير",
    "محاسب",
    "مدرس",
    "معلم",
    "مدرب",
    "أستاذ",
    "طبيب",
    "ممرض",
    "صيدلي",
    "طبيب أسنان",
    "جراح",
    "طبيب بيطري",
    "مهندس",
    "مهندس معماري",
    "مهندس مدني",
    "مهندس كهرباء",
    "مهندس ميكانيكا",
    "مبرمج",
    "مصمم",
    "رسام",
    "فنان",
    "كاتب",
    "شاعر",
    "مؤلف",
    "ممثل",
    "مغني",
    "راقص",
    "عازف",
    "ملحن",
    "منتج",
    "مصور",
    "مذيع",
    "معلق",
    "صحفي",
    "محرر",
    "كاتب محتوى",
    "مدون",
    "باحث",
    "عالم",
    "خبير",
    "مستشار",
    "محلل",
    "مستثمر",
    "تاجر",
    "بائع",
    "سائق",
    "طباخ",
    "شيف",
    "نادل",
    "نظافة",
    "خادم",
    "سباك",
    "كهربائي",
    "نجار",
    "حداد",
    "عامل",
    "بناء",
    "ميكانيكي",
    "مزارع",
    "فلاح",
    "صياد",
    "بحار",
    "غواص",
    "مضيف",
    "مضيفة",
    "طيار",
    "ربان",
    "حارس",
    "جندي",
    "شرطي",
    "إطفائي",
    "مقاتل",
    "محارب",
    "قائد",
    "مدير",
    "رئيس",
    "وزير",
    "سفير",
    "محافظ",
    "قاضي",
    "محامي",
    "مستشار",
    "باحث",
    "عالم",
    "كاتب",
    "شاعر",
    "صحفي",
    "مصور",
    "منتج",
    "ممثل",
    "مغني",
    "راقص",
    "عازف",
    "ملحن",
    "مدير",
    "رئيس",
    "وزير",
    "ملك",
    "أمير",
    "سلطان",
    "حارس",
    "جندي",
    "مقاتل",
    "شرطي",
    "إطفائي",
    "مدرب",
    "معلق",
    "قاضي",
    "محامي",
    "مستشار",
    "مستثمر",
    "محاسب",
    "محلل",
    "تاجر",
    "بائع",
    "سائق",
    "طباخ",
    "شيف",
    "نادل",
    "مزارع",
    "صياد",
    "مهندس",
    "طبيب",
    "ممرض",
    "مدرس",
    "كاتب",
    "شاعر",
    "صحفي",
    "ممثل",
    "مغني",
    "راقص",
    "عازف",
    "مدير",
    "رئيس",
    "قائد",
    "حارس",
    "جندي",
    "مقاتل"
  ];
  return json({ words });
};

const Game: React.FC = () => {
  const { words } = useLoaderData<typeof loader>();
  const [currentWord, setCurrentWord] = useState("");
  const [score, setScore] = useState(0);
  const [timeLeft, setTimeLeft] = useState(GAME_DURATION);
  const [gameStarted, setGameStarted] = useState(false);
  const [orientation, setOrientation] = useState({ beta: 0, gamma: 0 });
  const [lastAction, setLastAction] = useState<"correct" | "pass" | null>(null);
  const navigate = useNavigate();
  const [startingSoon, setStartingSoon] = useState(false);

  useEffect(() => {
    if (gameStarted && timeLeft > 0) {
      const timer = setTimeout(() => setTimeLeft(timeLeft - 1), 1000);
      return () => clearTimeout(timer);
    } else if (timeLeft === 0) {
      navigate("/results", { state: { score } });
    }
  }, [timeLeft, gameStarted, navigate, score]);

  useEffect(() => {
    if (gameStarted) {
      const handleOrientation = (event: DeviceOrientationEvent) => {
        const { alpha, beta, gamma } = event;
        console.log(`Alpha: ${alpha}, Beta: ${beta}, Gamma: ${gamma}`);
        setOrientation({
          beta: event.beta || 0,
          gamma: event.gamma || 0,
        });
      };

      window.addEventListener("deviceorientation", handleOrientation);

      return () => {
        window.removeEventListener("deviceorientation", handleOrientation);
      };
    }
  }, [gameStarted]);

  useEffect(() => {
    if (gameStarted) {
      if (orientation.gamma > TILT_THRESHOLD && lastAction !== "correct") {
        handleCorrect();
        setLastAction("correct");
      } else if (orientation.gamma < -TILT_THRESHOLD && lastAction !== "pass") {
        handlePass();
        setLastAction("pass");
      } else if (Math.abs(orientation.gamma) < 5) {
        setLastAction(null);
      }
    }
  }, [orientation, gameStarted]);

  const startGame = () => {
    setStartingSoon(true);
    setTimeout(() => {
      setStartingSoon(false);
      setGameStarted(true);
      nextWord();
    }, 3000);
  };

  const nextWord = () => {
    const randomIndex = Math.floor(Math.random() * words.length);
    setCurrentWord(words[randomIndex]);
  };

  const handleCorrect = () => {
    setScore(score + 1);
    nextWord();
  };

  const handlePass = () => {
    nextWord();
  };

  if (!gameStarted) {
    return startingSoon ? (
      <div
        className="flex h-screen flex-col items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 p-4"
        dir="rtl"
      >
        <p className="text-white">استعد ...</p>
      </div>
    ) : (
      <div
        className="flex h-screen flex-col items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 p-4"
        dir="rtl"
      >
        <h2 className="mb-4 text-2xl font-bold text-white text-center">
          هل أنت مستعد للعب؟
        </h2>

        <button
          onClick={startGame}
          className="rounded bg-white px-4 py-2 font-semibold text-blue-600 shadow transition hover:bg-blue-100"
        >
          ابدأ اللعبة
        </button>
      </div>
    );
  }

  return (
    <div
      className="flex h-screen flex-col items-center justify-center bg-gradient-to-br from-blue-500 to-purple-600 p-4"
      dir="rtl"
    >
      <div className="mb-8 text-center">
        <h2 className="text-8xl p-5 font-bold text-white">{currentWord}</h2>
        <p className="mt-2 text-xl text-white">
          الوقت المتبقي: {timeLeft} ثانية
        </p>
        <p className="mt-2 text-xl text-white">النتيجة: {score}</p>
      </div>
      <div className="flex flex-row w-full h-full">
        <button
          onClick={handleCorrect}
          className="rounded bg-green-500 font-semibold text-white shadow transition hover:bg-green-600 flex-1 h-full"
        >
          صحيح
        </button>
        <button
          onClick={handlePass}
          className="rounded bg-red-500 font-semibold text-white shadow transition hover:bg-red-600 flex-1 h-full"
        >
          تخطي
        </button>
      </div>
    </div>
  );
};

export default Game;
